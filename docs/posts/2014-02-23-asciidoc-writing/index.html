<h2 id="context_context_its_all_about_context" tabindex="-1">Context, context, it's all about context</h2><a class="direct-link" href="#context_context_its_all_about_context"><span class="visually-hidden">Permalink to “Context, context, it's all about context”</span> <span aria-hidden="true"></span></a><p>I started a little while ago to write a book. Yeah, I know, who would have thought, right? But that's besides the point.</p><p>Initially I used a writer specific app for Mac called <a href="http://www.ulyssesapp.com/" target="_blank" rel="noopener noreferrer">Ulysses</a> and while the app is really great, it has two disadvantages:</p><pre><code>  * it is available only for Mac (and maybe in the future for iOS)
  * not geeky enough (I know this is a stretch for a second reason, but hey!, I'm still a programmer)
</code></pre><p>So I ended up using <a href="http://asciidoctor.org/" target="_blank" rel="noopener noreferrer">AsciiDoc(tor)</a>. I flirted a bit with the idea of using it before, but the editor support kept me away (<a href="http://macromates.com/" target="_blank" rel="noopener noreferrer">TextMate</a>, <a href="https://wiki.gnome.org/Apps/Gedit" target="_blank" rel="noopener noreferrer">GEdit</a> and <a href="http://www.vim.org/" target="_blank" rel="noopener noreferrer">VIM</a>). After a while though, I decided to try it out with <a href="https://wiki.gnome.org/Apps/Gedit" target="_blank" rel="noopener noreferrer">GEdit</a>, which can work on pretty much on any Unix/Linux platform.</p><p>I did more than that, I refurbished a 7 year old laptop of mine into a so called &quot;word processor&quot;. A computer on which I am not allowed (self-imposed) to use anything else than writing related software, so no Facebook access, no Twitter, no RSS, no nothing.</p><h2 id="now_the_good_stuff" tabindex="-1">Now the good stuff</h2><a class="direct-link" href="#now_the_good_stuff"><span class="visually-hidden">Permalink to “Now the good stuff”</span> <span aria-hidden="true"></span></a><p>Instead of using the vanilla version of <a href="http://www.methods.co.nz/asciidoc/" target="_blank" rel="noopener noreferrer">AsciiDoc</a>, I opted in for <a href="http://asciidoctor.org/" target="_blank" rel="noopener noreferrer">AsciiDoctor</a> ruby gem which offers a few things on top. In case you don't know, <a href="http://www.methods.co.nz/asciidoc/" target="_blank" rel="noopener noreferrer">AsciiDoc</a> is a text document format, like Markdown, but it offers all the tools needed for writing longer pieces, like a book. The nice thing about it is that it's basically plain text with some basic markup and you can convert it to basically any format.</p><p>You can, but it is not always easy. I set up everything pretty much as described on the <a href="http://asciidoctor.org/docs/editing-asciidoc-with-live-preview/" target="_blank" rel="noopener noreferrer">AsciiDoctor page</a>, using the <a href="http://rubydoc.info/gems/guard/frames" target="_blank" rel="noopener noreferrer">Guard</a> gem and <a href="https://wiki.gnome.org/Apps/Web" target="_blank" rel="noopener noreferrer">Epiphany</a> for live preview. And it works great!</p><h3 id="troubleshooting" tabindex="-1">Troubleshooting</h3><a class="direct-link" href="#troubleshooting"><span class="visually-hidden">Permalink to “Troubleshooting”</span> <span aria-hidden="true"></span></a><p>Up till now, I didn't find too many things that weren't covered by documentation. Here's a small one and a bigger one:</p><h4 id="the_small_one_-_getting_the_css_file_sepparately_and_working_with_the_live_reload" tabindex="-1">The small one - getting the CSS file sepparately and working with the live reload</h4><a class="direct-link" href="#the_small_one_-_getting_the_css_file_sepparately_and_working_with_the_live_reload"><span class="visually-hidden">Permalink to “The small one - getting the CSS file sepparately and working with the live reload”</span> <span aria-hidden="true"></span></a><p>If you will set up the live reload configuration I mentioned, don't forget to run once the manual command for generating the HTML5 document, otherwise you won't have the styling in place. (I guess there must be a way to get the styling as well through the API, but for something that it doesn't change and that I'll probably throw away, I didn't spend much time for it)</p><p>So run at least once the following command:</p><pre><code>&lt;code&gt;asciidoctor -a linkcss mysample.adoc
&lt;/code&gt;
</code></pre><p>The <code>-a linkcss</code> option will tell the CLI to not set the CSS inline, but rather in a CSS file called <em>asciidoctor.css</em>.</p><h4 id="the_bigger_one_-_converting_to_pdf_and_customizing_the_fonts" tabindex="-1">The bigger one - converting to PDF and customizing the fonts</h4><a class="direct-link" href="#the_bigger_one_-_converting_to_pdf_and_customizing_the_fonts"><span class="visually-hidden">Permalink to “The bigger one - converting to PDF and customizing the fonts”</span> <span aria-hidden="true"></span></a><p>While ending up with a HTML is very easy, generating a PDF is not that instant:</p><pre><code>  * first convert to the DocBook format,
  * use [asciidoctor-fopub](https://github.com/asciidoctor/asciidoctor-fopub) for the rest
</code></pre><p>Once you set it up, things are pretty easy, unless you want to have special characters like <code>ţ</code>. Then you're into trouble:</p><pre><code>&lt;code&gt;WARNING: Glyph &quot;ţ&quot; (0x163, tcedilla) not available in font &quot;Times-Roman&quot;.
&lt;/code&gt;
</code></pre><p>You end up seeing a <code>#</code> in your pdf document. After a quick check, I found out that <a href="http://xmlgraphics.apache.org/fop/" target="_blank" rel="noopener noreferrer">Apache FOP</a>, the tool used to do the final conversion to PDF, supports only a handful of font families: Helvetica (normal, bold, italic, bold italic), Times (normal, bold, italic, bold italic), Courier (normal, bold, italic, bold italic), Symbol and ZapfDingbats[1].</p><p>So how do you setup custom fonts using the whole toolchain we've put together?<br>Simple!</p><p><strong>First</strong>, you need to know that there is a way to pass parameters directly to FOP through <a href="https://github.com/asciidoctor/asciidoctor-fopub" target="_blank" rel="noopener noreferrer">asciidoctor-fopub</a>, using the <code>-param</code> parameter. You can read more <a href="https://github.com/asciidoctor/asciidoctor-fopub#custom-xsl-parameters" target="_blank" rel="noopener noreferrer">here</a>.</p><p><strong>Second</strong>, some of these parameters can configure the font families used in different areas of the document, like the title or the body. Check this out:</p><pre><code>&lt;code&gt;fopub docbook.xml -param body.font.family Alegreya -param title.font.family AlegreyaSans
&lt;/code&gt;
</code></pre><p>Now if you do just that, you'll get a lot of warnings that Alegreya fonts cannot be found and the end result will be the same, no <code>ţ</code> in your text. There's one more piece to the puzzle!</p><p><strong>Third</strong>, copy the <code>docbook-xsl</code> folder from your local copy of the <a href="https://github.com/asciidoctor/asciidoctor-fopub" target="_blank" rel="noopener noreferrer">asciidoctor-fopub</a> into a different location and start customize it.</p><p>You will find there a magical file called <code>fop-config.xml</code> and in this file you can define custom fonts for <a href="http://xmlgraphics.apache.org/fop/" target="_blank" rel="noopener noreferrer">Apache FOP</a>.</p><pre><code>&lt;code&gt;
&lt;/code&gt;





&lt;code&gt;&lt;font kerning=&quot;yes&quot; embed-url=&quot;/toolchain/fonts/alegreya sans/AlegreyaSans-Regular.ttf&quot; embedding-mode=&quot;subset&quot;&gt;
           &lt;font-triplet name=&quot;AlegreyaSans&quot; style=&quot;normal&quot; weight=&quot;normal&quot;/&gt;
    &lt;/font&gt;
&lt;font kerning=&quot;yes&quot; embed-url=&quot;/toolchain/fonts/alegreya sans/AlegreyaSans-Bold.ttf&quot; embedding-mode=&quot;subset&quot;&gt;
           &lt;font-triplet name=&quot;AlegreyaSans&quot; style=&quot;normal&quot; weight=&quot;bold&quot;/&gt;
    &lt;/font&gt;
&lt;/code&gt;





&lt;code&gt;&lt;font kerning=&quot;yes&quot; embed-url=&quot;/toolchain/fonts/alegreya/Alegreya-Regular.ttf&quot; embedding-mode=&quot;subset&quot;&gt;
           &lt;font-triplet name=&quot;Alegreya&quot; style=&quot;normal&quot; weight=&quot;normal&quot;/&gt;
    &lt;/font&gt;
&lt;font kerning=&quot;yes&quot; embed-url=&quot;/toolchain/fonts/alegreya/Alegreya-Italic.ttf&quot; embedding-mode=&quot;subset&quot;&gt;
           &lt;font-triplet name=&quot;Alegreya&quot; style=&quot;italic&quot; weight=&quot;normal&quot;/&gt;
    &lt;/font&gt;
&lt;font kerning=&quot;yes&quot; embed-url=&quot;/toolchain/fonts/alegreya/Alegreya-Bold.ttf&quot; embedding-mode=&quot;subset&quot;&gt;
           &lt;font-triplet name=&quot;Alegreya&quot; style=&quot;normal&quot; weight=&quot;bold&quot;/&gt;
    &lt;/font&gt;
&lt;font kerning=&quot;yes&quot; embed-url=&quot;/toolchain/fonts/alegreya/Alegreya-BoldItalic.ttf&quot; embedding-mode=&quot;subset&quot;&gt;
           &lt;font-triplet name=&quot;Alegreya&quot; style=&quot;italic&quot; weight=&quot;bold&quot;/&gt;
    &lt;/font&gt;
&lt;/code&gt;
</code></pre><p>Of course, <code>embed-url</code> should point to the location where the font files are present. <strong>WARNING:</strong> Apache FOP doesn't support OTF fonts yet, so you should use TTF.</p><p>After that, update the <code>fopub</code> call with the path to your <code>docbook-xsl</code> and you're good to go!</p><pre><code>&lt;code&gt;fopub -t /home/alex/Dropbox/Writing/Bitopia/toolchain/docbook-xsl/ docbook.xml -param body.font.family Alegreya -param title.font.family AlegreyaSans
&lt;/code&gt;
</code></pre><ol><li>more details on the Apache FOP <a href="http://xmlgraphics.apache.org/fop/trunk/fonts.html" target="_blank" rel="noopener noreferrer">help page</a> ↩</li></ol>